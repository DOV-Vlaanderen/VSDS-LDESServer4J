<?xml version="1.0" encoding="UTF-8"?>
<!-- Copyright (C) 2010-2019 DOV, http://dov.vlaanderen.be// -->
<!-- All rights reserved -->

<configuration debug="true">

    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>

    <springProperty scope="context" name="APP_NAME" source="spring.application.name"/>

    <property name="LOG_FILE"
              value="${LOG_PATH:-${LOG_TEMP:-${java.io.tmpdir:-/tmp}}}/${APP_NAME}.log"/>
    <property name="LOGSTASH_FILE"
              value="${LOG_PATH:-${LOG_TEMP:-${java.io.tmpdir:-/tmp}}}/${APP_NAME}.jsonlog"/>

    <include resource="org/springframework/boot/logging/logback/console-appender.xml"/>
    <include resource="org/springframework/boot/logging/logback/file-appender.xml"/>
    <!--  Appender to log to file in a JSON format  -->
    <appender name="LOGSTASH" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOGSTASH_FILE}</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.FixedWindowRollingPolicy">
            <fileNamePattern>${LOGSTASH_FILE}.%i.gz</fileNamePattern>
            <maxIndex>10</maxIndex>
        </rollingPolicy>
        <triggeringPolicy class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy">
            <MaxFileSize>10MB</MaxFileSize>
        </triggeringPolicy>
        <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>
    </appender>


    <!-- NEVER, EVER modify this one! -->
    <springProfile name="oefen,productie">
        <root level="ERROR">
            <appender-ref ref="LOGSTASH"/>
            <appender-ref ref="FILE"/>
        </root>
    </springProfile>

    <springProfile name="ontwikkel">
        <!-- proxy log incomming requests -->
        <root level="WARN">
            <appender-ref ref="LOGSTASH"/>
            <appender-ref ref="FILE"/>
        </root>
    </springProfile>

    <springProfile name="local">
        <root level="INFO">
            <appender-ref ref="CONSOLE"/>
            <appender-ref ref="FILE"/>
        </root>
    </springProfile>

</configuration>